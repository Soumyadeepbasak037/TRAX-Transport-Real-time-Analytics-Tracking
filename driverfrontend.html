<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Driver Frontend</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
  <h1>Driver App</h1>
  <p>Status: <span id="status">Connecting...</span></p>

  <script>
    const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NCwidXNlcm5hbWUiOiJzYjEiLCJyb2xlIjoiZHJpdmVyIiwidmVoaWNsZUlkIjoyLCJpYXQiOjE3NTc2MTA1MzMsImV4cCI6MTc1NzYxNDEzM30.9zsOFUONrf1SkSFmhiOxkhW44hMg3TJyvbk-fcRlKwE"; // ðŸ”¹ Replace with actual driver JWT
  const socket = io("https://localhost:3000", {
  auth: { token: token },
  transports: ["websocket"], // force websocket
  secure: true
});

    socket.on("connect", () => {
      document.getElementById("status").innerText = "Connected âœ…";
      console.log("Driver connected to backend");
    });

    socket.on("disconnect", () => {
      document.getElementById("status").innerText = "Disconnected âŒ";
    });

    // ðŸ”¹ Function to send current location
    function sendLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const { latitude, longitude, accuracy, speed } = position.coords;

            socket.emit("driverLocation", {
              lat: latitude,
              lng: longitude,
              speed: speed || 0,
              accuracy: accuracy || 0,
            });

            console.log("Location sent:", latitude, longitude);
          },
          (error) => {
            console.error("Geolocation error:", error);
          },
          { enableHighAccuracy: true }
        );
      } else {
        console.error("Geolocation is not supported by this browser.");
      }
    }

    // ðŸ”¹ Send location every 1.5 seconds regardless of movement
    setInterval(sendLocation, 1500);
  </script>
</body>
</html>
